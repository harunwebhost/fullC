<?phprequire_once('../functions/db_function.php'); ini_set("display_errors",1); 	 		 	$fileName=strtotime("now").$_FILES['uplaod']['name']; 		 	$templocation=$_FILES['uplaod']['tmp_name']; 		 	$targetPath="uploadedfiles/"; 		 	$targetPath=$targetPath.basename($fileName);	 		move_uploaded_file($templocation,$targetPath); 			$fileName=$targetPath;				$count=0;				$total_failed=0;				$total_uplaod_leads=0;	 		$dublicateFile=""; 			if (!empty($fileName)) { 				$fileExtention=explode('.',$fileName);							if($fileExtention[1]!="csv"){					unlink($fileName);					page_redirection("upload_lead.php","Upload Only .csv");										}						 					if ($fileExtention[1]=="csv") { 													 							$open_file=fopen($fileName, "r"); 							$skipHeading=0; 							$failed = []; 								$faild_leads=""; 							while($fileData=fgetcsv($open_file,30000,",")){ 								$skipHeading++; 								$name=$fileData[0]; 								$email=$fileData[1]; 								$mobile=$fileData[2]; 								$city=$fileData[3]; 								$leadFrom=$fileData[4]; 								$employeeId=$fileData[5]; 								$dublicateFile="uploadfailed/".strtotime("now").".csv"; 								$opendublicateFile=fopen($dublicateFile, "w");	 								$lables="Name".",Email".",Mobile".",City,"."From Leaad,"."EmployeeId,"."\n"; 								if ($skipHeading!=1) { 										$selectDublicate="SELECT * FROM crm_leads where lead_mobile='$mobile'"; 										$getDublicate=execute_sql_query($selectDublicate); 										$count=sql_fetch_num_rows($getDublicate); 										if ($count>0) { 											 												$fetch_dublicate_leads=execute_fetch($getDublicate); 												//echo mysqli_error($connection); 												$emp_id=$fetch_dublicate_leads['emp_id']; 												$selectEmp="select * from crm_employer where emp_id='$emp_id'"; 												$execute_emp=execute_sql_query($selectEmp); 												$fetchEmployerName=execute_fetch($execute_emp); 												$getEmployerName=$fetchEmployerName['emp_name'];																								$total_failed=$total_failed+1;												if(empty($getEmployerName)){ 													$getEmployerName="lead is not assined"; 												}	$faild_leads.=$fetch_dublicate_leads["lead_name"].",".$fetch_dublicate_leads["lead_email"].",".$fetch_dublicate_leads["lead_mobile"].",".$fetch_dublicate_leads["lead_city"].",".$fetch_dublicate_leads["lead_from"].",".$getEmployerName."\n"; 											 										}else{ 												if (empty($employeeId)) { 													$leadStatus="Not assined"; 												}else{ 													$leadStatus="assined"; 												} 										 $sqlInsert="INSERT INTO  crm_leads VALUES(NULL,'$name','$email','$mobile','$city','$leadFrom','$employeeId','$leadStatus')"; 											$execteInsert=execute_sql_query($sqlInsert);											$total_uplaod_leads=$total_uplaod_leads+1;	 										}	 								} 									 							} 							if($count>0) 									fputs($opendublicateFile,$lables.$faild_leads); 								} 					}else{ 				page_redirection("google.com","hello"); 				} 				if ($count>0) { 					echo "<a href=$dublicateFile>Download Faild</a>"; 				} 				 	 			?><?php		echo "Results:-";	echo "Total File Containt:".($total_failed+$total_uplaod_leads);	echo "<br>Total Uploaded:-".$total_uplaod_leads;	echo "<br>Total Faild:-".$total_failed; ?> 